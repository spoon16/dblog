{% extends 'blog/base.html' %}

{% load humanize %}
{% load markup %}
{% load gravatar %}
{% load comments %}

{% block content %}
  {% if entry %}
    <div class="entry_container">
      <div class="clearfix">
        {% if entry.is_new %}
          <span class="newtag label success">New</span>
        {% endif %}
        <h2 class="title">{{ entry.title }} <small>{{ entry.created|naturalday }}</small></h2>
      </div>
      <div class="entry">
        {{ entry.body|markdown }}
      </div>
      <div class="comment_container">
        {% get_comment_count for entry as comment_count %}
        <h3>{{ comment_count }} Comments</h3>
        {% get_comment_list for entry as comments %}
        {% for comment in comments %}
          <div class="comment">
            <div class="author vcard">
              <img class="photo" src="{% gravatar_href comment.user_email %}" />
              <span class="fn n"><a class="url" href="{{ comment.user_url }}" rel="external nofollow">{{ comment.user_name }}</a></span>
            </div>
            <div class="meta">{{ comment.submit_date|naturalday }}</div>
            <div class="body">{{ comment.comment|markdown }}</div>
          </div>
        {% endfor %}
        <h3>Post a Comment</h3>
        {% get_comment_form for entry as form %}
        <form class="form-stacked" action="{% comment_form_target %}" method="post">
          <fieldset>
            {% csrf_token %}
            {{ form }}
            <input type="hidden" name="next" value="{{ request.path }}" />
            <div class="actions">
              <input type="submit" class="btn primary" value="Post" />
            </div>
          </fieldset>
        </form>
      </div>
    </div> 
  {% endif %}
{% endblock content %}
